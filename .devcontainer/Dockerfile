{
  "name": "Serena-MCP Autonomous Dev Container with GPU",
  "version": "2.0.0",
  
  // GPUå¯¾å¿œã®CUDA 13.0ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ï¼ˆæœ€æ–°å®‰å®šç‰ˆï¼‰
  "image": "nvidia/cuda:13.0.0-cudnn-devel-ubuntu22.04",
  
  // GPUæœ‰åŠ¹åŒ–ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
  "runArgs": [
    "--gpus=all",
    "--network=host",
    "-v", "/var/run/docker.sock:/var/run/docker.sock",
    "--privileged=true",
    "--cap-add=SYS_ADMIN",
    "--security-opt", "seccomp=unconfined"
  ],
  
  // GPUç’°å¢ƒå¤‰æ•°ã®è¨­å®š
  "remoteEnv": {
    "PATH": "${containerEnv:PATH}:/usr/local/cuda/bin",
    "LD_LIBRARY_PATH": "$LD_LIBRARY_PATH:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64",
    "XLA_FLAGS": "--xla_gpu_cuda_data_dir=/usr/local/cuda",
    "NVIDIA_VISIBLE_DEVICES": "all",
    "NVIDIA_DRIVER_CAPABILITIES": "compute,utility",
    "CUDA_VISIBLE_DEVICES": "all",
    
    // Serena-MCPè¨­å®š
    "SERENA_AUTO_LEVEL": "5",
    "SERENA_CONTEXT": "ide-assistant",
    "SERENA_PROJECT_PATH": "/workspaces/${localWorkspaceFolderBasename}",
    
    // APIã‚­ãƒ¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰ç¶™æ‰¿ï¼‰
    "ANTHROPIC_API_KEY": "${localEnv:ANTHROPIC_API_KEY}",
    "GEMINI_API_KEY": "${localEnv:GEMINI_API_KEY}"
  },
  
  // åˆæœŸåŒ–ã‚³ãƒãƒ³ãƒ‰ï¼ˆé †æ¬¡å®Ÿè¡Œï¼‰
  "onCreateCommand": {
    "install-base": "apt-get update && apt-get install -y curl git build-essential python3 python3-pip nodejs npm",
    "install-uv": "curl -LsSf https://astral.sh/uv/install.sh | sh",
    "install-cli-tools": "npm install -g @anthropic-ai/claude-code @google/gemini-cli"
  },
  
  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  "postCreateCommand": {
    "verify-gpu": "nvidia-smi",
    "setup-project": "make setup || echo 'No Makefile found'",
    "init-serena": "uvx --from git+https://github.com/oraios/serena serena activate_project ${containerWorkspaceFolder}",
    "create-directories": "mkdir -p ~/.serena ~/.gemini ~/.claude/commands ~/PDF",
    "set-permissions": "chmod -R 755 ~/.serena ~/.gemini ~/.claude ~/PDF"
  },
  
  // èµ·å‹•æ™‚ã‚³ãƒãƒ³ãƒ‰
  "postStartCommand": {
    "start-serena": "nohup uvx --from git+https://github.com/oraios/serena serena start-mcp-server --transport sse --port 9121 --context ide-assistant --auto-level 5 > /tmp/serena.log 2>&1 &",
    "show-status": "echo 'ğŸ¤– Serena-MCP Server running on http://localhost:9121/sse' && echo 'ğŸ® GPU: ' && nvidia-smi --query-gpu=name --format=csv,noheader"
  },
  
  // VS Codeè¨­å®š
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "python.defaultInterpreterPath": "/usr/bin/python3",
        
        // MCP Serverè¨­å®š
        "mcp.servers": {
          "serena": {
            "command": "uvx",
            "args": [
              "--from",
              "git+https://github.com/oraios/serena",
              "serena",
              "start-mcp-server",
              "--transport", "stdio",
              "--context", "ide-assistant",
              "--project", "${workspaceFolder}",
              "--auto-level", "5"
            ]
          }
        },
        
        // Claude Codeè¨­å®š
        "claude.mcpServers": {
          "serena": {
            "enabled": true,
            "autoStart": true
          }
        }
      },
      
      "extensions": [
        // é–‹ç™ºåŸºæœ¬ãƒ„ãƒ¼ãƒ«
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "ms-python.python",
        "ms-python.vscode-pylance",
        
        // AI/MLé–¢é€£
        "ms-toolsai.jupyter",
        "ms-toolsai.vscode-jupyter-cell-tags",
        "nvidia.nsight-vscode-edition",
        
        // Git/GitHub
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "eamodio.gitlens",
        
        // ã‚³ãƒ³ãƒ†ãƒŠé–¢é€£
        "ms-azuretools.vscode-docker",
        "ms-vscode-remote.remote-containers"
      ]
    }
  },
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
  "remoteUser": "root",
  
  // è¿½åŠ æ©Ÿèƒ½
  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "moby": true,
      "installDockerBuildx": true
    },
    "ghcr.io/devcontainers/features/python:1": {
      "version": "3.11"
    },
    "ghcr.io/devcontainers/features/node:1": {
      "version": "20"
    }
  },
  
  // ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
  "forwardPorts": [
    9121,  // Serena-MCP SSE Server
    3000,  // é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆNext.jsç­‰ï¼‰
    8080,  // APIã‚µãƒ¼ãƒãƒ¼
    5173,  // Vite
    8888   // Jupyter
  ],
  
  // ãƒ›ã‚¹ãƒˆè¦ä»¶
  "hostRequirements": {
    "gpu": "optional",
    "cpus": 4,
    "memory": "8gb",
    "storage": "32gb"
  },
  
  // ãƒã‚¦ãƒ³ãƒˆè¨­å®š
  "mounts": [
    // PDFãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒã‚¦ãƒ³ãƒˆ
    "source=${localEnv:HOME}/PDF,target=/root/PDF,type=bind,consistency=cached",
    // Serenaè¨­å®šã‚’æ°¸ç¶šåŒ–
    "source=${localEnv:HOME}/.serena,target=/root/.serena,type=bind,consistency=cached",
    // SSHè¨­å®š
    "source=${localEnv:HOME}/.ssh,target=/root/.ssh,type=bind,readonly"
  ],
  
  // å¾…æ©Ÿè¨­å®š
  "waitFor": "postStartCommand",
  
  // æ›´æ–°æ™‚ã®å‹•ä½œ
  "updateContentCommand": "echo 'Checking for updates...' && npm update -g @anthropic-ai/claude-code @google/gemini-cli",
  
  // ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³æ™‚ã®å‡¦ç†
  "shutdownAction": "stopContainer"
}