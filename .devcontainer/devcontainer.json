{
  "name": "Serena-MCP Autonomous Dev Container with GPU",
  "version": "2.1.0",
  
  // ã‚«ã‚¹ã‚¿ãƒ Dockerfileã‚’ä½¿ç”¨
  "dockerFile": "Dockerfile",
  
  // GPUæœ‰åŠ¹åŒ–ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
  "runArgs": [
    "--gpus=all",
    "--network=host",
    "-v", "/var/run/docker.sock:/var/run/docker.sock",
    "--privileged=true",
    "--cap-add=SYS_ADMIN",
    "--security-opt", "seccomp=unconfined"
  ],
  
  // GPUç’°å¢ƒå¤‰æ•°ã®è¨­å®š
  "remoteEnv": {
    "PATH": "${containerEnv:PATH}:/usr/local/cuda/bin:/root/.local/bin",
    "LD_LIBRARY_PATH": "$LD_LIBRARY_PATH:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64",
    "XLA_FLAGS": "--xla_gpu_cuda_data_dir=/usr/local/cuda",
    "NVIDIA_VISIBLE_DEVICES": "all",
    "NVIDIA_DRIVER_CAPABILITIES": "compute,utility",
    "CUDA_VISIBLE_DEVICES": "all",
    
    // Serena-MCPè¨­å®š
    "SERENA_AUTO_LEVEL": "5",
    "SERENA_CONTEXT": "ide-assistant",
    "SERENA_PROJECT_PATH": "/workspaces/${localWorkspaceFolderBasename}",
    
    // APIã‚­ãƒ¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰ç¶™æ‰¿ï¼‰
    "ANTHROPIC_API_KEY": "${localEnv:ANTHROPIC_API_KEY}",
    "GEMINI_API_KEY": "${localEnv:GEMINI_API_KEY}"
  },
  
  // åˆæœŸåŒ–ã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚³ãƒ³ãƒ†ãƒŠä½œæˆæ™‚ã«ä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰
  "onCreateCommand": {
    "verify-tools": "echo '=== Verifying Tools ===' && which node && which npm && which python3 && which uvx || true",
    "install-claude": "echo 'Installing Claude Code...' && npm install -g @anthropic-ai/claude-code && which claude",
    "install-gemini": "echo 'Installing Gemini CLI...' && npm install -g @google/gemini-cli && which gemini",
    "create-dirs": "mkdir -p ~/.serena ~/.gemini ~/.claude/commands ~/PDF /tmp/serena",
    "show-versions": "echo '=== Installed Versions ===' && node --version && npm --version && python3 --version"
  },
  
  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆä½œæˆå¾Œï¼‰
  "postCreateCommand": {
    "verify-gpu": "nvidia-smi --query-gpu=name,memory.total --format=csv,noheader || echo 'GPU not available'",
    "verify-commands": "echo 'Checking commands...' && (claude --version || echo 'Claude not installed') && (gemini --version || echo 'Gemini not installed')",
    "setup-project": "if [ -f Makefile ]; then make setup; else echo 'No Makefile found'; fi",
    "set-permissions": "chmod -R 755 ~/.serena ~/.gemini ~/.claude ~/PDF"
  },
  
  // èµ·å‹•æ™‚ã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã®ãŸã³ã«å®Ÿè¡Œï¼‰
  "postStartCommand": {
    "start-serena": "nohup uvx --from git+https://github.com/oraios/serena serena start-mcp-server --transport sse --port 9121 --context ide-assistant --auto-level 5 > /tmp/serena.log 2>&1 &",
    "wait-for-serena": "sleep 3",
    "show-status": "echo 'ğŸ¤– Serena-MCP Server should be running on http://localhost:9121/sse' && echo 'ğŸ“ Check logs at /tmp/serena.log' && echo 'ğŸ® GPU Status:' && (nvidia-smi --query-gpu=name --format=csv,noheader || echo 'No GPU')"
  },
  
  // VS Codeè¨­å®š
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.env.linux": {
          "PATH": "${env:PATH}:/root/.local/bin"
        },
        "python.defaultInterpreterPath": "/usr/bin/python3",
        
        // MCP Serverè¨­å®š
        "mcp.servers": {
          "serena": {
            "command": "uvx",
            "args": [
              "--from",
              "git+https://github.com/oraios/serena",
              "serena",
              "start-mcp-server",
              "--transport", "stdio",
              "--context", "ide-assistant",
              "--project", "${workspaceFolder}",
              "--auto-level", "5"
            ]
          }
        },
        
        // Claude Codeè¨­å®š
        "claude.mcpServers": {
          "serena": {
            "enabled": true,
            "autoStart": true
          }
        }
      },
      
      "extensions": [
        // é–‹ç™ºåŸºæœ¬ãƒ„ãƒ¼ãƒ«
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "ms-python.python",
        "ms-python.vscode-pylance",
        
        // AI/MLé–¢é€£
        "ms-toolsai.jupyter",
        "ms-toolsai.vscode-jupyter-cell-tags",
        
        // Git/GitHub
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "eamodio.gitlens",
        
        // ã‚³ãƒ³ãƒ†ãƒŠé–¢é€£
        "ms-azuretools.vscode-docker",
        "ms-vscode-remote.remote-containers"
      ]
    }
  },
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
  "remoteUser": "root",
  
  // è¿½åŠ æ©Ÿèƒ½
  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "moby": true,
      "installDockerBuildx": true
    }
  },
  
  // ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
  "forwardPorts": [
    9121,  // Serena-MCP SSE Server
    3000,  // é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆNext.jsç­‰ï¼‰
    8080,  // APIã‚µãƒ¼ãƒãƒ¼
    5173,  // Vite
    8888   // Jupyter
  ],
  
  // ãƒ›ã‚¹ãƒˆè¦ä»¶
  "hostRequirements": {
    "gpu": "optional",
    "cpus": 4,
    "memory": "8gb",
    "storage": "32gb"
  },
  
  // ãƒã‚¦ãƒ³ãƒˆè¨­å®š
  "mounts": [
    // PDFãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒã‚¦ãƒ³ãƒˆï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰
    "source=${localEnv:HOME}/PDF,target=/root/PDF,type=bind,consistency=cached",
    // SSHè¨­å®šï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰
    "source=${localEnv:HOME}/.ssh,target=/root/.ssh,type=bind,readonly"
  ],
  
  // å¾…æ©Ÿè¨­å®š
  "waitFor": "postStartCommand",
  
  // æ›´æ–°æ™‚ã®å‹•ä½œï¼ˆå®šæœŸçš„ã«æœ€æ–°ç‰ˆã‚’ç¢ºèªï¼‰
  "updateContentCommand": "echo 'Checking for updates...' && npm list -g @anthropic-ai/claude-code @google/gemini-cli || true",
  
  // ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³æ™‚ã®å‡¦ç†
  "shutdownAction": "stopContainer"
}